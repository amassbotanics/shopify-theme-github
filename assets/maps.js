var map,bounds,geocoder,markerCluster,currentInfoWindow,mapSettings=require("./map-settings.js"),initExpandables=function(){$(".expandable-toggle").on("click",function(e){e.preventDefault(),$(this).parents(".expandable").toggleClass("open")})},markersInView=[],locations=[],defaultZoom=15,initMap=function(){var e=document.getElementById("location"),o=new google.maps.places.Autocomplete(e);o.setFields(["address_components","geometry","icon","name"]),o.addListener("place_changed",function(){$("#location").parents("form").submit()}),$("#locator-form").on("submit",function(e){e.preventDefault(),geocoder=new google.maps.Geocoder;var o=$("#location").val();geocoder.geocode({address:o},function(e,o){var t,a;o==google.maps.GeocoderStatus.OK?(t=new google.maps.LatLngBounds,a=new google.maps.LatLng(e[0].geometry.location.lat(),e[0].geometry.location.lng()),t.extend(a),map.setCenter(t.getCenter()),map.setZoom(13)):console.log("Geocode was not successful for the following reason: "+o)})}),$('input[name="location_type"]').on("change",function(){n()}),$("body").on("click","[data-location-id]",function(e){e.preventDefault();var o=$(this).attr("data-location-id");map.markers.forEach(function(e){e.locationId==o&&(map.setZoom(17),map.panTo(e.position),new google.maps.event.trigger(e,"click"),(new _smoothScroll.default).animateScroll($("#top")[0]))})});function a(){if(markersInView=[],map.getBounds()){for(var e=0;e<map.markers.length;e++)map.getBounds().contains(map.markers[e].getPosition())&&void 0!==locations[e]&&markersInView.push(locations[e]);void 0!==map.markerClusterer&&null!==map.markerClusterer&&map.markerClusterer.repaint(),t(markersInView)}}var t=function(e){$(".location-text-results").html("");var a="dark";$("body").hasClass("storytellers-site")&&(a="white"),$(e).each(function(e,o){var t='\n        <div class="col-10 col-lg-3 link-block" data-category="'.concat(o.category,'">\n        <div class="text wysiwyg-text h-100 d-flex flex-column">\n          <p class="type--b-em"><a href="#" data-location-id="').concat(o.id,'">').concat(o.name,'</a></p>\n          <p class="wysiwyg-content">\n            ').concat(o.address,"<br>\n            ").concat(o.phone,'\n          </p>\n          <p class="cta mt-auto">\n            <a href="').concat(o.url,'" target="_blank" class="cta caret-link type--cta ').concat(a,'">Visit Website<i class="caret"></i></a>\n          </p>\n        </div>\n      </div>\n      ');$(".location-text-results").append(t)})},n=function(){var e=$('input[name="location_type"]:checked').val();$(".location-text-results[data-show]").length&&$(".location-text-results[data-show]").attr("data-show",e),map.markerClusterer.setIgnoreHidden(!0);for(var o=0;o<map.markers.length;o++)map.markers[o].setVisible(!1);map.markerClusterer.repaint();for(o=0;o<map.markers.length;o++)map.markers[o].locationType==e&&map.markers[o].setVisible(!0);map.markerClusterer.repaint(),a()};var s=null;function r(e){bounds=new google.maps.LatLngBounds,$.each(e.markers,function(e,o){var t=new google.maps.LatLng(o.position.lat(),o.position.lng());bounds.extend(t)}),1==e.markers.length?(e.setCenter(bounds.getCenter()),e.setZoom(16)):e.fitBounds(bounds)}$(".locator-map-container").length&&($(window).width()<992&&(defaultZoom=14),map=function(e){mapSettings.styles;var o={zoom:defaultZoom,center:new google.maps.LatLng(34.09523,-118.3727),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:mapSettings.styles,panControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_BOTTOM},scrollwheel:!1,mapTypeControl:!1,overviewMapControl:!1,fullscreenControl:!1,overviewMapControlOptions:{opened:!1},streetViewControl:!1,scaleControl:!1},t=new google.maps.Map(e[0],o);return t.markers=[],$.getJSON("https://storemapper-herokuapp-com.global.ssl.fastly.net/api/users/5340/stores.js",function(e){$(e.stores).each(function(e,o){locations.push(o),function(e,o){var t=new google.maps.LatLng(e.latitude,e.longitude),a=new google.maps.Marker({position:t,map:o,locationId:e.id,locationType:e.category,optimized:!0,icon:{url:$(".map").attr("data-marker-icon"),anchor:new google.maps.Point(0,16.5),size:new google.maps.Size(33,40)}});o.markers.push(a);var n="\n    <h3>".concat(e.name,"</h3>\n    <p>").concat(e.address,"</p>\n    <p>").concat(e.category,'</p>\n    <p><a href="').concat(e.url,'" target="_blank">').concat(e.url,"</a></p>\n    ");{var r;n&&(r=new google.maps.InfoWindow({content:n,maxWidth:400}),google.maps.event.addListener(a,"click",function(){s&&s.close(),(s=r).open(o,a)}))}}(o,t)});var o=[{url:$(".map").attr("data-cluster-icon"),textColor:"white",textSize:16,height:40,width:40,textLineHeight:40,backgroundPosition:"0 0 "}];1<t.markers.length&&(t.markerClusterer=new _markerclustererplus.default(t,t.markers,{styles:o,imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"}),n()),google.maps.event.addListener(t,"bounds_changed",function(){a()}),r(t)}),google.maps.event.addDomListener(window,"resize",function(){r(t)}),t}($(".locator-map-container .map")))};